// Delaunay.js r.1 - http://github.com/sokeroner/Delaunay-Triangulation
// + patch R.Turboult : increase supertriangle size to avoid non-convex hull
var Delaunay=Delaunay||{};Delaunay.Point=function(c,b){this.x=c;this.y=b};Delaunay.Point.prototype.distance=function(c){return Math.sqrt((c.x-this.x)*(c.x-this.x)+(c.y-this.y)*(c.y-this.y))};Delaunay.Point.prototype.equals2d=function(c){return this.x==c.x&&this.y==c.y};Delaunay.Triangle=function(c,b,a){this.p1=c;this.p2=b;this.p3=a};Delaunay.Triangle.prototype.getCenter=function(){this.center==null&&(center=new Delaunay.Point(0,0));center.x=(this.p1.x+this.p2.x+this.p3.x)/3;center.y=(this.p1.y+this.p2.y+this.p3.y)/3;return center};
Delaunay.Triangle.prototype.getSidesCenters=function(){if(this.mid0==null||this.mid1==null||this.mid2==null)mid0=new Delaunay.Point(0,0),mid1=new Delaunay.Point(0,0),mid2=new Delaunay.Point(0,0);this.mid0.x=this.p1.x+(this.p2.x-this.p1.x)/2;this.mid0.y=this.p1.y+(this.p2.y-this.p1.y)/2;this.mid1.x=this.p2.x+(this.p3.x-this.p2.x)/2;this.mid1.y=this.p2.y+(this.p3.y-this.p2.y)/2;this.mid2.x=this.p3.x+(this.p1.x-this.p3.x)/2;this.mid2.y=this.p3.y+(this.p1.y-this.p3.y)/2};Delaunay.Edge=function(c,b){this.p1=c;this.p2=b};Delaunay.Edge.prototype.equals=function(c){return this.p1==c.p2&&this.p2==c.p1||this.p1==c.p1&&this.p2==c.p2};Delaunay.InCircle=function(c,b,a,d){var h=Number.MIN_VALUE;if(Math.abs(b.y-a.y)<h&&Math.abs(a.y-d.y)<h)return!1;var e,g,f,i;Math.abs(a.y-b.y)<h?(e=-(d.x-a.x)/(d.y-a.y),f=(a.x+d.x)*0.5,d=(a.y+d.y)*0.5,b=(a.x+b.x)*0.5,h=e*(b-f)+d):(Math.abs(d.y-a.y)<h?(h=-(a.x-b.x)/(a.y-b.y),g=(b.x+a.x)*0.5,i=(b.y+a.y)*0.5,b=(d.x+a.x)*0.5):(h=-(a.x-b.x)/(a.y-b.y),e=-(d.x-a.x)/(d.y-a.y),g=(b.x+a.x)*0.5,f=(a.x+d.x)*0.5,i=(b.y+a.y)*0.5,d=(a.y+d.y)*0.5,b=(h*g-e*f+d-i)/(h-e)),h=h*(b-g)+i);e=a.x-b;a=a.y-h;g=e*e+a*a;e=c.x-
b;a=c.y-h;return e*e+a*a<=g};Delaunay.Triangulate=function(c){var b,a,d=c.length;if(d<3)return[];var h=4*d,e=c[0].x;a=c[0].y;var g=e,f=a;for(b=1;b<d;b++){c[b].id=b;if(c[b].x<e)e=c[b].x;if(c[b].x>g)g=c[b].x;if(c[b].y<a)a=c[b].y;if(c[b].y>f)f=c[b].y}b=g-e;var i=f-a;b*=10;i*=10;b=b>i?b:i;e=(g+e)*0.5;a=(f+a)*0.5;c.push(new Delaunay.Point(e-2*b,a-b,d+1));c.push(new Delaunay.Point(e,a+2*b,d+2));c.push(new Delaunay.Point(e+2*b,a-b,d+3));f=[];c[d].id=d;c[d+1].id=d+1;c[d+2].id=d+2;f.push(new Delaunay.Triangle(c[d],c[d+1],c[d+2]));for(b=0;b<d;b++){e=
[];for(a=0;a<f.length;a++)Delaunay.InCircle(c[b],f[a].p1,f[a].p2,f[a].p3)&&(e.push(new Delaunay.Edge(f[a].p1,f[a].p2)),e.push(new Delaunay.Edge(f[a].p2,f[a].p3)),e.push(new Delaunay.Edge(f[a].p3,f[a].p1)),f.splice(a,1),a--);if(!(b>=d)){for(a=e.length-2;a>=0;a--)for(g=e.length-1;g>=a+1;g--)e[a].equals(e[g])&&(e.splice(g,1),e.splice(a,1),g--);for(a=0;a<e.length;a++)f.length>=h&&DEBUG.warning("Exceeded maximum edges"),f.push(new Delaunay.Triangle(e[a].p1,e[a].p2,c[b]))}}for(b=f.length-1;b>=0;b--)(f[b].p1.id>=
d||f[b].p2.id>=d||f[b].p3.id>=d)&&f.splice(b,1);c.splice(c.length-1,1);c.splice(c.length-1,1);c.splice(c.length-1,1);return f.concat()};var DEBUG=DEBUG||{};DEBUG.active=!0;DEBUG.trace=function(c){this.active&&console.log(c)};DEBUG.warning=function(c){this.active&&console.log(c)};DEBUG.alert=function(c){this.active&&alert(c)};DEBUG.TODO=function(c){this.active&&console.warn("TODO: "+c)};DEBUG.clear=function(){console.clear()};